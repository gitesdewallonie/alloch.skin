<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      metal:use-macro="context/main_template/macros/master"
      lang="en"
      i18n:domain="plone">

<metal:javascriptslot fill-slot="javascript_head_slot"> 
    <tal:script tal:content="structure view/getCompleteMap">
    </tal:script>
</metal:javascriptslot>

<body>

<div metal:fill-slot="main"
     i18n:domain="alloch">

    <div id="header">
        <div id="header_map">
            <div id="map">
            </div>
        </div>
    </div>

    <script type="text/javascript">
        jQuery(document).ready(function() {
        //   jq('a.heb-detail-link').prepOverlay({
        //      subtype: 'ajax',
        //      filter: '#content > *'
        //      });
          load();  // loads map
        });
    </script>

    <h1 i18n:translate="search_results_title">Search results</h1>
    <p>&nbsp;</p>
    <div tal:define="hebs view/getSearchResults">
        <div tal:define="lang request/LANGUAGE | en"
             tal:condition="hebs">
            <div tal:repeat="heb hebs">
                <tal:if tal:condition="not: heb/grouped">
                    <a href="" class="heb-detail-link" title="Details of this accomodation"
                       tal:attributes="href string:${context/portal_url}/heb-detail?hebPk=${heb/heb_pk}"
                       i18n:attributes="title details_of_this_heb">
                        <h2>
                            <img src="" border="0" tal:attributes="src string:${portal_url}/vignettes_heb/${heb/getVignette}" />
                            <span tal:replace="repeat/heb/number" />.&nbsp;
                            <span tal:replace="python: heb.type.getTitle(lang)" />
                            <span tal:replace="heb/heb_nom" />
                            &rarr;&nbsp;(<span tal:content="string:${heb/heb_cgt_cap_min}/${heb/heb_cgt_cap_max}" />)
                        </h2>
                    </a>
                    Distance : <span tal:replace="heb/distance" /> km
                    <br />
                    <span tal:replace="python: heb.getDescription(lang)" />
                    <br /><br />
                </tal:if>
                <tal:else tal:condition="heb/grouped">
                    <span tal:define="room1 python: heb.rooms[0]">
                        <a href="" class="heb-detail-link" title="Details of this accomodation"
                           tal:attributes="href string:${context/portal_url}/heb-detail?hebPk=${heb/heb_pk}"
                           i18n:attributes="title details_of_this_heb">
                            <h2>
                                <img src="" border="0" tal:attributes="src string:${portal_url}/vignettes_heb/${room1/getVignette}" />
                                <span tal:replace="repeat/heb/number" />.&nbsp;
                                <span tal:replace="python: room1.type.getTitle(lang)" />
                                <span tal:replace="room1/heb_nom" />
                                &rarr;&nbsp;(<span tal:content="string:${room1/heb_cgt_cap_min}/${room1/heb_cgt_cap_max}" />)
                            </h2>
                        </a>
                        Distance : <span tal:replace="heb/distance" /> km
                        <br />
                        <span tal:replace="python: room1.getDescription(lang)" />
                    </span>
                    <a href="" class="heb-group-link" title="Rooms of this accomodation"
                       tal:attributes="href string:${context/portal_url}/rooms-list?group=${heb/heb_pro_fk}"
                       i18n:attributes="title rooms_of_this_heb">
                        <h3>
                            <span tal:content="python: len(heb.rooms)-1" /> other room(s)
                        </h3>
                    </a>
                    <br />
                </tal:else>
            </div>

        </div>
        <div tal:condition="not: hebs"
             i18n:translate="no_results">
            No results found.
        </div>
    </div>

</div>
</body>
</html>
